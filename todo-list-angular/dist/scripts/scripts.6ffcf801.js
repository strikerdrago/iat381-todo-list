"use strict";function pushBall(a,b){sklad.open(dbName,options,function(c,d){console.log("attempting to push a single ball");var e=JSON.parse(JSON.stringify(a));console.log(e);var f={balltable:[{index:b,value:e}]};console.log(f),d.upsert(f,function(a,b){if(a)throw new Error(a.message);console.log("That was ball "+b+" in the db")})})}function pushBalls(a){sklad.open(dbName,options,function(b,c){for(var d=JSON.parse(JSON.stringify(a)),e=0;e<d.length;e++){var f={index:e,value:d[e]};c.upsert("balltable",f,function(a,b){if(a)throw new Error(a.message)})}})}function deleteBalls(){sklad.open(dbName,options,function(a,b){b.clear("balltable",function(a){if(a)throw new Error(a.message)})})}function getBalls(){sklad.open(dbName,options,function(a,b){b.get({balltable:{}},function(a,b){if(a)throw new Error(a.message);0==balls.length&&0!=b.balltable.length?(firstRun=!1,b.balltable.forEach(function(a,b){if(a.key>=0){var c=a.value.value,d=c.radius,e=new Point(c.point[1],c.point[2]),f=new Point({angle:270,length:3}),g=new PointText({fillColor:"#ffffff",fontFamily:"Open Sans",fontWeight:"bold",fontSize:18}),h=c.textInput[1].content,i=c.nextText[1].content,j=new Ball(d,e,f,g);j.textInput.content=h,j.nextText.content=i;var k=c.alarmTimeMilliseconds;j.alarmTimeMilliseconds=k,void 0!=k&&(nextAlarm=new Date(k),monthdayParsed=nextAlarm.getMonth()+" "+nextAlarm.getDate(),hmsParsed=nextAlarm.getHours()+":"+nextAlarm.getMinutes()+":"+nextAlarm.getSeconds(),console.log(monthdayParsed+" "+hmsParsed),j.timerText.content=hmsParsed),balls.push(j)}})):0==b.balltable.length&&(console.log("nothing here"),firstRun=!1)})})}function onFrame(){if(!tapped){for(var a=0;a<balls.length-1;a++)for(var b=a+1;b<balls.length;b++)balls[a].react(balls[b]);for(var a=0,c=balls.length;c>a;a++)if(balls[a].iterate(),balls[a].timeUntilAlarm&&balls[a].alarmTimeMilliseconds&&balls[a].alarmTimeMilliseconds<=(new Date).getTime()&&(balls[a].alarmTimeMilliseconds=null,balls[a].timeUntilAlarm=null,balls[a].timeUntilAlarmUnits=null,balls[a].timerText.content="",pushBalls(balls),alert("To-do reminder: "+balls[a].textInput.content),userEmail)){var d=new mandrill.Mandrill("1v6xLdleNNB5t5G3RaHkBA");console.log(userEmail);var e={message:{from_email:"dannyblackstock@gmail.com",to:[{email:userEmail}],subject:"To-do reminder: "+balls[a].textInput.content,text:"To-do reminder: "+balls[a].textInput.content}};d.messages.send(e,function(a){console.log(a)},function(a){console.log(res)})}}0!=balls.length?noitemsoverlay.style.display="none":(noitemsoverlay.style.display="block",firstRun&&getBalls())}function Ball(a,b,c,d){this.radius=a,this.point=b,this.vector=c,this.maxVec=2,this.numSegment=8,this.boundOffset=[],this.boundOffsetBuff=[],this.sidePoints=[],this.weight=-.1,this.timeUntilAlarm,this.timeUntilAlarmUnits="seconds",this.alarmTimeMilliseconds,this.path=new Path({fillColor:{hue:Math.round(this.radius/120*360),saturation:1,brightness:1}});for(var e=0;e<this.numSegment;e++)this.boundOffset.push(this.radius),this.boundOffsetBuff.push(this.radius),this.path.add(new Point),this.sidePoints.push(new Point({angle:360/this.numSegment*e,length:1}));this.tempPath=this.path.clone(),this.textInput=d,this.textInput.justification="left",this.textInput.content="",this.textInput.position.x-=this.radius,this.nextText=d.clone(),this.nextText.content="",this.timerText=d.clone(),this.timerText.justification="center",this.timerText.fontSize=12,this.timerText.content=void 0==this.alarmTimeMilliseconds?"":new Date(this.alarmTimeMilliseconds);var f=new Group([this.tempPath,this.textInput,this.nextText,this.timerText]);f.clipped=!0}function onTap(a){if("singletap"==a.type)for(var b=0;b<balls.length;b++)if(inCircle(balls[b].point.x,balls[b].point.y,balls[b].radius,a.center.x,a.center.y+paper.view.bounds.y)){currentBall=balls[b],interactingWithExistingCircle=!0,currentBallIndex=balls.indexOf(currentBall),tapped=!0,tappedTodo();break}}function onPinch(a){if("pinchstart"==a.type){for(var b=0;b<balls.length;b++)if(inCircle(balls[b].point.x,balls[b].point.y,balls[b].radius,a.center.x,a.center.y+paper.view.bounds.y)&&!interactingWithExistingCircle){currentBall=balls[b],console.log("I am in ball "+b),interactingWithExistingCircle=!0,tempText=currentBall.textInput.content,tempVector=currentBall.vector,tempWeight=currentBall.weight,currentBall.vector=new Point({angle:0,length:0}),currentBall.weight=0;break}if(!interactingWithExistingCircle){creatingCircle=!0;var c=60*Math.random()+60,d=new Point(a.center.x,a.center.y+paper.view.bounds.y),e=new Ball(c,d,new Point({angle:360*Math.random(),length:10*Math.random()}),new PointText({fillColor:"#ffffff",fontFamily:"Open Sans",fontWeight:"bold",fontSize:18}));balls.push(e),tempText=e.textInput.content,currentBallIndex=balls.indexOf(e)}}else"pinchmove"==a.type?interactingWithExistingCircle&&(currentBall.radius=50*a.scale,currentBall.radius<minRadius?(currentBall.path.fillColor="#ff0000",currentBall.textInput.content="DELETE!",currentBall.nextText.visible=!1):currentBall.radius>maxRadius?(currentBall.radius=maxRadius,currentBall.path.fillColor.hue=String(Math.round(currentBall.radius/120*360)),currentBall.nextText.visible=!0,currentBall.textInput.content=creatingCircle?tempText:tempText):(currentBall.path.fillColor.hue=String(Math.round(currentBall.radius/120*360)),currentBall.nextText.visible=!0,currentBall.textInput.fontSize=currentBall.radius/120*18,currentBall.textInput.content=creatingCircle?tempText:tempText)):"pinchend"==a.type&&interactionEnd()}function onPan(a){if("panstart"==a.type)for(var b=0;b<balls.length;b++){if(inCircle(balls[b].point.x,balls[b].point.y,balls[b].radius,a.center.x,a.center.y+paper.view.bounds.y)&&!interactingWithExistingCircle){currentBall=balls[b],interactingWithExistingCircle=!0,tempVector=currentBall.vector,tempWeight=currentBall.weight,currentBall.vector=new Point({angle:0,length:0}),currentBall.weight=0;break}inCircle(balls[b].point.x,balls[b].point.y,balls[b].radius,a.center.x,a.center.y+paper.view.bounds.y)||interactingWithExistingCircle||(scrolling=!0,paper.view.bounds.y+-a.deltaY/10>0&&paper.view.scrollBy(new Point(0,-a.deltaY/10)))}else"panmove"==a.type?interactingWithExistingCircle?(currentBall.point.x=a.center.x,currentBall.point.y=a.center.y+paper.view.bounds.y,currentBall.point.y>paper.view.bounds.height+paper.view.bounds.y-50?paper.view.scrollBy(new Point(0,7)):currentBall.point.y<paper.view.bounds.y+50&&paper.view.bounds.y-5>0&&paper.view.scrollBy(new Point(0,-7))):paper.view.bounds.y+-a.deltaY/10>0&&paper.view.scrollBy(new Point(0,-a.deltaY/10)):"panend"==a.type&&interactionEnd()}function interactionEnd(){var a;currentBall&&(a=balls.indexOf(currentBall),currentBall.radius<minRadius&&(currentBall.path.remove(),currentBall.tempPath.remove(),currentBall.textInput.remove(),a>-1&&(balls.splice(a,1),deleteBalls()))),creatingCircle&&(creatingCircle=!1,currentBall?currentBall.radius>minRadius&&(tapped=!0,tappedTodo()):(tapped=!0,tappedTodo())),tempVector&&tempWeight&&currentBall&&(currentBall.vector=tempVector,currentBall.weight=tempWeight),tempVector=null,tempWeight=null,interactingWithExistingCircle=!1,currentBall=null,scrolling=!1,console.log(a),void 0!=a&&pushBalls(balls)}function inCircle(a,b,c,d,e){var f=Math.abs(d-a),g=Math.abs(e-b),h=c;return f>h?!1:g>h?!1:h>=f+g?!0:f^2+g^h>=2^2?!0:!1}var app=angular.module("todoListAngularApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]);angular.module("todoListAngularApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("todoListAngularApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);var firstRun=!0,dbName="dbtest",options={version:2,migration:{1:function(a){a.createObjectStore("balltable",{keyPath:"index",autoIncrement:!0})}}};testFunction=function(){};var mc=new Hammer.Manager(document.getElementById("rainBalls"),{recognizers:[[Hammer.Pinch,{enable:!0}]]});mc.add(new Hammer.Pan({threshold:0,pointers:0})),mc.add(new Hammer.Pinch({threshold:0})).recognizeWith([mc.get("pan")]),mc.add(new Hammer.Press({time:"200"})),mc.add(new Hammer.Tap({event:"singletap"})),Ball.prototype={iterate:function(){this.checkBorders(),this.vector.length>this.maxVec&&(this.vector.length=this.maxVec),this.point+=this.vector,this.vector.y+=this.weight,this.textInput.point=this.point,this.textInput.point.x-=this.radius-15,this.textInput.point.y+=10,this.nextText.point=this.point,this.nextText.point.x-=this.radius-15,this.nextText.point.y+=30,this.nextText.fontSize=this.textInput.fontSize,this.timerText.point=this.point,this.timerText.point.y+=this.radius-25,this.updateShape()},checkBorders:function(){var a=view.size;this.point.x<this.radius&&(this.point.x=this.radius),this.point.x>a.width-this.radius&&(this.point.x=a.width-this.radius),this.point.y<this.radius&&(this.point.y=this.radius)},updateShape:function(){for(var a=this.path.segments,b=0;b<this.numSegment;b++)a[b].point=this.getSidePoint(b);for(var b=0;b<this.numSegment;b++){this.boundOffset[b]<this.radius/4&&(this.boundOffset[b]=this.radius/4);var c=(b+1)%this.numSegment,d=b>0?b-1:this.numSegment-1,e=this.boundOffset[b];e+=(this.radius-e)/15,e+=((this.boundOffset[c]+this.boundOffset[d])/2-e)/3,this.boundOffsetBuff[b]=this.boundOffset[b]=e}for(var f=this.tempPath.segments,b=0;b<this.numSegment;b++)f[b].point=this.getSidePoint(b)},react:function(a){var b=this.point.getDistance(a.point);if(b<this.radius+a.radius&&0!=b){var c=this.radius+a.radius-b,d=(this.point-a.point).normalize(.015*c);this.vector+=d,a.vector-=d,this.calcBounds(a),a.calcBounds(this),this.updateBounds(),a.updateBounds()}},getBoundOffset:function(a){var b=this.point-a,c=(b.angle+180)%360;return this.boundOffset[Math.floor(c/360*this.boundOffset.length)]},calcBounds:function(a){for(var b=0;b<this.numSegment;b++){var c=this.getSidePoint(b),d=a.getBoundOffset(c),e=c.getDistance(a.point);d>e&&(this.boundOffsetBuff[b]-=(d-e)/2)}},getSidePoint:function(a){return this.point+this.sidePoints[a]*this.boundOffset[a]},updateBounds:function(){for(var a=0;a<this.numSegment;a++)this.boundOffset[a]=this.boundOffsetBuff[a]}};var balls=[];mc.on("panstart panmove panend",onPan),mc.on("pinchstart pinchmove pinchend",onPinch),mc.on("singletap",onTap);var interactingWithExistingCircle=!1,creatingCircle=!1,currentBall,tempWeight,tempVector,minRadius=60,maxRadius=120,tempText="",overlay=document.getElementById("overlay"),overlayDisplay=document.getElementById("overlay").style.display,noitemsoverlay=document.getElementById("noitemstext"),todofield=document.getElementById("todofield"),numTimeUnits=$("#numTimeUnits"),timeUnits=$("#timeUnits"),scrolling=!1,tapped=!1,userEmail;tappedTodo=function(){var a=currentBallIndex,b="";console.log(balls[a].textInput.content),b=balls[a].textInput.content+balls[a].nextText.content,todofield.value=b,numTimeUnits.val(balls[a].timeUntilAlarm),$("#email-field").val(userEmail),numTimeUnits.val()?($("#remind-me-button").hide(),$("#timer-container").show()):($("#remind-me-button").show(),$("#timer-container").hide()),$("#overlay").toggleClass("shown"),$("#todolist").show(),$("#overlay").css("background-color","hsl("+balls[a].path.fillColor.hue+", 75%, 50%)")},textEditSubmit=function(){var a=currentBallIndex;console.log(a),balls.length>0,tapped=!1,interactingWithExistingCircle=!1,balls[a].textInput.content=todofield.value,balls[a].timeUntilAlarm=+numTimeUnits.val(),balls[a].timeUntilAlarmUnits=timeUnits.val();var b=0;switch(timeUnits.val()){case"seconds":b=1e3;break;case"minutes":b=6e4;break;case"hours":b=36e5;break;case"days":b=864e5}if(todofield.value.length>-1&&todofield.value.length<=20)console.log("just right"),balls[a].nextText.content="";else if(todofield.value.length>20){console.log("halp I'm too big");var c=todofield.value.slice(0,20),d=todofield.value.slice(20);console.log(c),console.log(d),balls[a].textInput.content=c,balls[a].nextText.content=d}var e=(new Date).getTime()+numTimeUnits.val()*b;balls[a].alarmTimeMilliseconds=e,userEmail=$("#email-field").val(),nextAlarm=new Date(e),monthdayParsed=nextAlarm.getMonth()+" "+nextAlarm.getDate(),hmsParsed=nextAlarm.getHours()+":"+nextAlarm.getMinutes()+":"+nextAlarm.getSeconds(),console.log(monthdayParsed+" "+hmsParsed),balls[a].timerText.content=hmsParsed,console.log(balls[a]),pushBall(balls[a],a),$("#overlay").toggleClass("shown"),$("#todolist").hide()},$("#remind-me-button").on("click",function(){$("#remind-me-button").slideUp(200),$("#timer-container").show()}),$("#cancel-button").on("click",function(){numTimeUnits.val(null),timeUnits.val("seconds"),$("#timer-container").slideUp(200),$("#remind-me-button").show()});